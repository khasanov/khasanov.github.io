Есть у меня одна программка, написана на Qt, использует mongodb, под гентой собирается с помощью cmake, примерно так:

# emerge mongodb
$ cmake ..
$ make

 Все отлично.

 Но надо вдруг собрать бинарник под виндой, под хрюшу, естесственно. 


 Ну ок, ставлю виртуалку и в неё пиратского зверя.
Итак, нужен cmake, качаю, запускаю cmake-gui. Конечно, нужен компилятор.

 Ок, качаю mingw, ставлю, cmake его не видит. Почему? Потому что его в системный path прописать надо, прописываю, перезагружаюсь.
Следующий пункт, Qt. Качаю QtSDK, собранный mingw.

 Ок, cmake делает Makefile. Но вот сборка не идет, т. к. конечно же нужны заголовочники для mongo. Ок, качаю.

 Снова облом. А почему? Потому что нужен windows sdk. Ок, качаю, запускаю. Облом! Для установки WinSDK нужен .net4.
Ок, качаю дотнет, ставлю, перезагружаюсь, ставлю sdk, перезагружаюсь.

 Сборка не идет. Почему? Потому что надо поставить еще VisualC++ Runtime Redistributable.
Ок, качаю, перезагружаюсь, ставлю.

 Сборка не идет. А почему? Хз, т. к. виндовская консоль не умеет юникод и сыплет ошибками, которые прочитать невозможно.

 Ок, запускаю QtCreator, пытаюсь собрать из него. Ага, теперь ошибки хотя бы можно прочитать!
Ок, выясняется, что плюсовый рантайм в винде собран MSVS, и с mingw не совместим.

 Ок, качаю Visual Studio 2010, ставлю, перезагружаюсь.

 Запускаю cmake для генерации солюшена. Нет, облом, QtSDK собран MingGW.

 Ок, качаю версию кутей, собранную студией, качаю аддон к студии.
Аддон не встанет на express-версию студии, нужна Professional.

 Ок, качаю, ставлю, перезагружаюсь, ставлю аддон, ставлю либы.
Запускаю cmake-gui, генерирую солюшен, попутно исправив путь к qmake на тот, который собран студией.

 Сmake выдает следующее: 

 Could not copy from: C:/Program Files/CMake 2.8/share/cmake-2.8/Templates/CMakeVSMacros2.vsmacros to: C:/Documents and Settings/Admin/Ìîè äîêóìåíòû/Visual Studio 2010/Projects/VSMacros80/CMakeMacros/CMakeVSMacros2.vsmacros

 Ок, копирую вручную, генерирую солюшен, открываю студией.

 Студия долго думает, парсит исходники, начинает собирать и сбивается с многозначительным выхлопом:

 error C2664: 'mongo::toUtf8String' : cannot convert 
parameter 1 from 'LPTSTR' to 'const std::wstring &' 

 Ок, гуглю, ставлю Character Set в значение “Use Unicode Character Set” вместо “Use Multi-byte Character Set”.

 Ок, компиляция почти проходит, однако само-собой линковка сбивается.

 fatal error LNK1181: cannot open input file 'mongoclient.lib'

 Ок, на сайте монги сказано, что надо собирать самому. Система сборки --- scons.

 Ок, качаю scons, при установке само собой выясняется, что нужен python.

 Ок, качаю питон, ставлю, ставлю scons. Добавляю в path C:\Python27\Scripts, перезагружаюсь.

 Качаю плюсовый драйвер с сайта монги, запускаю scons mongoclient... Нет такой цели.

 Ок, качаю полные исходники монги. Запускаю scons mongoclient --release, облом, нужен буст. 

 Ок, качаю прекомпиленый boost, причём лежать он должен только в C:\boost.

 Ок, mongoclient.lib собирается, правда весит 155 мб. Ну да пока пофигу.

 Ок, в студии прописываю линкеру путь к либе, но:

 LINK : fatal error LNK1104: cannot open file 'libboost_thread-vc100-mt-1_42.lib'

 А почему? А потому что буст собран как Multi-threaded /MT, а в студии выставлено /MD.

 Ок, исправляю, теперь осталось только исправить undefined reference на какие-то символы. Гуглю, добавляю линкеру зависимость от ws2_32.lib.

 Компилируется. Создает заветный .exe, который конечно не запустится. Кидаю в папочку с ним QtCore4.dll, QtGui4.dll.


Квест пройден. Прога работает.
